GREP_WARN := $(GREP) --color -i -f latex-warnings -C3 -H

DOCUMENT := dissertation
COMPONENTS := \
  title.tex \
  intro.tex \
  theory.tex \
  coordTransform.tex \
  horizPressureGrad.tex \
  tf.tex \
  cellShaving.tex \
  finiteVolume.tex \
  verticalStaggering.tex \
  gravityWavesTheory.tex \
  methodology.tex \
  results.tex \
  conclusions.tex \
  furtherWork.tex \
  horizAdvection.tex \
  resting.tex \
  gravityWaves.tex \
  wobblyTracerAdvection.tex \
  wobblyThetaAdvection.tex \
  mathmacros.tex \
  dissertationmacros.tex \
  geometry.tex \
  variable-placement.tex \
  cubicUpwind-stencil.tex \
  small-cell.tex \
  vertical-staggering.tex \
  theta-oscillation.tex \
  gw-phases.tex
GNUPLOT_OUTPUTS := \
  btf-plot.tex \
  sleve-plot.tex \
  full-step-plot.tex \
  partial-step-plot.tex \
  cut-cell-plot.tex \
  gravityWaves-propagating-plot.tex \
  gravityWaves-evanescent-plot.tex \
  advection-initial-plot.tex \
  advection-noOrography-analytic-contour-plot.tex \
  advection-btf-schaerCos-cubicUpwindCPCFit-contour-plot.tex \
  advection-sleve-schaerCos-cubicUpwindCPCFit-contour-plot.tex \
  advection-snapCol-schaerCos-cubicUpwindCPCFit-contour-plot.tex \
  resting-w-plot.tex \
  resting-energy-total-tf-plot.tex \
  resting-energy-total-snapCol-plot.tex \
  resting-energy-total-noOrography-plot.tex \
  resting-energy-btf-plot.tex \
  resting-energy-sleve-plot.tex \
  resting-energy-snapCol-plot.tex \
  gravityWaves-schaerExp-h-exnerTheta-plot.tex \
  gravityWaves-courant-max-plot.tex \
  gravityWaves-courant-mean-plot.tex \
  wobblyTracerAdvection-btf-schaerCos-cubicUpwindCPCFit-contour-plot.tex \
  wobblyTracerAdvection-snapCol-schaerCos-cubicUpwindCPCFit-contour-plot.tex
PLOT_PATCH_DATA_OUTPUTS := \
  mesh-snapCol-schaerExp-resting.eps \
  data/gravityWaves-btf-schaerExp-h/18000/w.eps \
  data/gravityWaves-sleve-schaerExp-h/18000/w.eps \
  data/gravityWaves-snapCol-schaerExp-h/18000/w.eps \
  data/gravityWaves-sleve-schaerExp-h/18000/thetaDiff.eps \
  data/gravityWaves-snapCol-schaerExp-h/18000/thetaDiff.eps \
  data/gravityWaves-sleve-schaerExp-h/18000/UfZoom.eps \
  data/gravityWaves-snapCol-schaerExp-h/18000/UfZoom.eps \
  data/gravityWaves-sleve-schaerExp-h/18000/nonlinearMomentumZoom.eps \
  data/gravityWaves-snapCol-schaerExp-h/18000/nonlinearMomentumZoom.eps \
  openfoam/cases/wobblyTracerAdvection/btf/schaerCos/cubicUpwindCPCFit/0/U.eps \
  openfoam/cases/wobblyThetaAdvection/btf/schaerExp/cubicUpwindCPCFit/18000/thetaDiff.eps \
  openfoam/cases/wobblyThetaAdvection/snapCol/schaerExp/cubicUpwindCPCFit/18000/thetaDiff.eps
PLOTS := $(GNUPLOT_OUTPUTS) $(PLOT_PATCH_DATA_OUTPUTS)
STATISTICS_FILES := \
  advection/noOrography/cubicUpwindCPCFit/$(L2_ERROR_STAT) \
  advection/btf/schaerCos/cubicUpwindCPCFit/$(L2_ERROR_STAT) \
  advection/sleve/schaerCos/cubicUpwindCPCFit/$(L2_ERROR_STAT) \
  advection/snapCol/schaerCos/cubicUpwindCPCFit/$(L2_ERROR_STAT) \
  wobblyTracerAdvection/btf/schaerCos/cubicUpwindCPCFit/$(L2_ERROR_STAT) \
  wobblyTracerAdvection/snapCol/schaerCos/cubicUpwindCPCFit/$(L2_ERROR_STAT)
STATISTICS := $(addprefix openfoam/cases/,$(STATISTICS_FILES))
BIBLIOGRAPHIES := dissertation.bib journals.bib

.PHONY: all-latex wc draft clean-latex

all-latex: $(DOCUMENT).pdf

clean-latex:
	rm -rf $(DOCUMENT).pdf *.bbl *.bcf *.blg *.toc *.run.xml *.pyg *.log *.aux *.out

wc:
	$(TEXCOUNT) -merge -sub=chapter $(DOCUMENT).tex

draft: $(DOCUMENT).tex $(COMPONENTS) $(PLOTS) $(STATISTICS)
	@$(PDFLATEX) "\def\classopts{,draft}\def\geometryopts{,showframe}\input{$(DOCUMENT)}"

$(DOCUMENT).pdf: \
  $(DOCUMENT).tex \
  $(COMPONENTS) \
  $(PLOTS) \
  $(BIBLIOGRAPHIES) \
  $(STATISTICS) \
  biblatex.cfg
	$(PDFLATEX) -draftmode $(DOCUMENT)
	$(BIBER) $(DOCUMENT)
	$(PDFLATEX) $(DOCUMENT) | tee $(DOCUMENT).pdflatex.log | $(GREP_WARN) --label=pdflatex

