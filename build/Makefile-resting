RESTING_END_TIME := 21600
RESTING_FINAL_THETA_FIELD := $(RESTING_END_TIME)/theta
# TODO: any others?  e.g. U or Uf?
RESTING_FINAL_FIELDS := $(RESTING_END_TIME)/Exner $(RESTING_END_TIME)/theta

# $(1) -- simulation case path
# $(2) -- subproject label
# $(3) -- mesh case path
define RESTING_TEMPLATE

  $(eval $(call PHYSICAL_TEST_CASE_TEMPLATE,$(1),$(2),$(3)))

  .PHONY: $(2) clean-$(2)
  .INTERMEDIATE: $(2).exnerFoam.intermediate

  all:: $(2)

  clean:: clean-$(2)

  $(2): $(addprefix $(1)/,$(RESTING_FINAL_FIELDS))

  clean-$(2):
	$(RM) -r $(1)

  $(addprefix $(1)/,$(RESTING_FINAL_FIELDS)): $(2).exnerFoam.intermediate

  $(2).exnerFoam.intermediate: \
    $(addprefix $(1)/,$(SYSTEM_FILES)) \
    $(addprefix $(1)/,$(INITIAL_PHYSICAL_FIELDS))
	$(EXNER_FOAM_H) -case $(1) > $(2).exnerFoamH.log

  $(1)/$(THETA_INIT):
	$(LN) -fs $(COMMON_CASE)/$(THETA_INIT) $$@

  $(1)/$(EXNER_INIT):
	$(LN) -fs $(COMMON_CASE)/$(EXNER_INIT) $$@

  $(1)/$(INITIAL_UF_FIELD):
	$(LN) -fs $(COMMON_CASE)/$(INITIAL_UF_FIELD) $$@

  $(1)/$(ENVIRONMENTAL_PROPERTIES):
	$(LN) -fs $(COMMON_CASE)/$(ENVIRONMENTAL_PROPERTIES).resting $$@

  $(1)/$(THERMOPHYSICAL_PROPERTIES):
	$(LN) -fs $(COMMON_CASE)/$(THERMOPHYSICAL_PROPERTIES) $$@

  $(1)/$(CONTROL_DICT):
	$(LN) -fs $(COMMON_CASE)/system/controlDictResting $$@

  $(1)/$(FV_SCHEMES):
	$(LN) -fs $(COMMON_CASE)/system/fvSchemesResting $$@

  $(1)/$(FV_SOLUTION):
	$(LN) -fs $(COMMON_CASE)/system/fvSolutionResting $$@

endef

$(eval $(call RESTING_TEMPLATE,openfoam/cases/resting/noOrography,resting-noOrography,openfoam/cases/mesh/noOrography/resting))
$(eval $(call RESTING_TEMPLATE,openfoam/cases/resting/btf/schaerExp,resting-btf-schaerExp,openfoam/cases/mesh/btf/schaerExp/resting))
$(eval $(call RESTING_TEMPLATE,openfoam/cases/resting/sleve/schaerExp,resting-sleve-schaerExp,openfoam/cases/mesh/sleve/schaerExp/resting))
$(eval $(call RESTING_TEMPLATE,openfoam/cases/resting/snap/schaerExp,resting-snap-schaerExp,openfoam/cases/mesh/snap/schaerExp/resting))

