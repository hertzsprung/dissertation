RESTING_END_TIME := 21600
RESTING_FINAL_THETA_FIELD := $(RESTING_END_TIME)/theta
RESTING_INITIAL_EXNER_FIELD := 0/Exner
RESTING_INITIAL_THETA_FIELDS := 0/BruntFreq 0/BruntFreq2f 0/theta 0/thetaf
RESTING_INITIAL_FIELDS := $(RESTING_INITIAL_THETA_FIELDS) $(RESTING_INITIAL_EXNER_FIELD)
# TODO: any others?  e.g. U or Uf?
RESTING_FINAL_FIELDS := $(RESTING_END_TIME)/Exner $(RESTING_END_TIME)/theta

THETA_INIT := constant/theta_init
EXNER_INIT := constant/Exner_init

# $(1) -- simulation case path
# $(2) -- subproject label (e.g. advection_noOrography)
# $(3) -- mesh case path (e.g. btf/schaerCos)
define RESTING_TEMPLATE

  .PHONY: $(2) clean-$(2)
  .INTERMEDIATE: $(2).theta.intermediate $(2).exnerFoam.intermediate

  $(2): $(addprefix $(1)/,$(RESTING_FINAL_FIELDS))

  $(addprefix $(1)/,$(RESTING_FINAL_FIELDS)): $(2).exnerFoam.intermediate

  $(2).exnerFoam.intermediate: \
    $(addprefix $(1)/,$(SYSTEM_FILES)) \
    $(addprefix $(1)/,$(RESTING_INITIAL_FIELDS))
	$(EXNER_FOAM_H) -case $(1) > $(2).exnerFoamH.log

  $(addprefix $(1)/,$(RESTING_INITIAL_THETA_FIELDS)): $(2).theta.intermediate

  $(2).theta.intermediate: \
    $(1)/$(POLY_MESH_DIR) \
    $(addprefix $(3)/,$(MESH_FILES)) \
    $(1)/$(THETA_INIT)
	$(SET_THETA) -case $(1) > $(2).setTheta.log

  $(1)/$(RESTING_INITIAL_EXNER_FIELD): \
    $(1)/$(POLY_MESH_DIR) \
    $(addprefix $(3)/,$(MESH_FILES)) \
    $(1)/$(EXNER_INIT)
	$(SET_EXNER_BALANCED_H) -case $(1) > $(2).setExnerBalancedH.log
	$(SED) -i 's/fixedValue;/fixedFluxBuoyantExner; gradient uniform 0;/g' $(1)/$(RESTING_INITIAL_EXNER_FIELD)

  clean-$(2):
	$(PY_FOAM_CLEAR_CASE) $(1)
	$(RM) $(addprefix $(1)/,$(RESTING_INITIAL_FIELDS))

  # TODO: C&Ped from advection
  $(1)/$(POLY_MESH_DIR): $(3)/$(POLY_MESH_DIR)
	$(LN) -fs $(abspath $(3)/$(POLY_MESH_DIR)) $(1)/$(POLY_MESH_DIR)

endef

$(eval $(call RESTING_TEMPLATE,openfoam/cases/resting/noOrography,resting-noOrography,openfoam/cases/mesh/noOrography/resting))

$(eval $(call RESTING_TEMPLATE,openfoam/cases/resting/btf/schaerCos,resting-btf-schaerCos,openfoam/cases/mesh/btf/schaerCos/resting))

$(eval $(call RESTING_TEMPLATE,openfoam/cases/resting/snap/schaerCos,resting-snap-schaerCos,openfoam/cases/mesh/snap/schaerCos/resting))

clean:: clean-resting-btf-schaerCos
