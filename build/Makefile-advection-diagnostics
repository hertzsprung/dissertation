ADVECTION_END_TIME := 10000
ADVECTION_FINAL_TRACER_FIELD := $(ADVECTION_END_TIME)/T

CONTOUR_DATA := 0/0.1.dat 5000/0.1.dat 10000/0.1.dat
TRACER_CONTOUR_DICT := $(GMT_DICTS)/tracer-contour

# $(1) -- simulation case path
# $(2) -- subproject label
define ADVECTION_DIAGNOSTICS_TEMPLATE

  .INTERMEDIATE: $(2).contour.intermediate

  $(2)-contour.plt: $(addprefix $(1)/,$(CONTOUR_DATA))

  $(addprefix $(1)/,$(CONTOUR_DATA)): $(2).contour.intermediate

  $(2).contour.intermediate: \
    $(1)/$(ADVECTION_FINAL_TRACER_FIELD) \
    $(1)/$(TRACER_CONTOUR_DICT)
	$(PLOT_PATCH_DATA) -case $(1) -time 0 tracer-contour > $(2).plotPatchData.tracer-contour.0.log
	$(PS_CONTOUR) $(1)/0/T.dat -D$(1)/0/%.1f.dat -Ccontours.cpt
	$(SED) -i -re 's/^>.*$$$$//' $(1)/0/*.dat

	$(PLOT_PATCH_DATA) -case $(1) -time 5000 tracer-contour > $(2).plotPatchData.tracer-contour.5000.log
	$(PS_CONTOUR) $(1)/5000/T.dat -D$(1)/5000/%.1f.dat -Ccontours.cpt
	$(SED) -i -re 's/^>.*$$$$//' $(1)/5000/*.dat

	$(PLOT_PATCH_DATA) -case $(1) -time 10000 tracer-contour > $(2).plotPatchData.tracer-contour.10000.log
	$(PS_CONTOUR) $(1)/10000/T.dat -D$(1)/10000/%.1f.dat -Ccontours.cpt
	$(SED) -i -re 's/^>.*$$$$//' $(1)/10000/*.dat

  $(1)/$(TRACER_CONTOUR_DICT): $(COMMON_CASE)/$(TRACER_CONTOUR_DICT) | $(1)/$(GMT_DICTS)
	$(LN) -fs $$< $$@

endef
