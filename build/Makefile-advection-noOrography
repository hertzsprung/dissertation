export COMMON_CASE := $(abspath openfoam/cases/common)

END_TIME := 10000
INITIAL_CONDITIONS := constant/initialConditions
TRANSPORT_PROPERTIES := constant/transportProperties

ADVECTION_FINAL_TRACER_FIELD := $(END_TIME)/T
ADVECTION_INITIAL_FIELDS := 0/U 0/T

# $(1) -- simulation case path
# $(2) -- subproject label (e.g. advection_noOrography)
# $(3) -- mesh case path (e.g. btf/schaerCos)
# TODO: assign $(addprefix $(1)/,...) stuff to a variable
define ADVECTION_TEMPLATE

  .PHONY: $(2) clean-$(2)
  .INTERMEDIATE: $(2).intermediate

  $(2): $(1)/$(ADVECTION_FINAL_TRACER_FIELD)

  clean-$(2):
	$(PY_FOAM_CLEAR_CASE) --additional=0 $(1)

  $(1)/$(ADVECTION_FINAL_TRACER_FIELD): $(addprefix $(1)/,$(ADVECTION_INITIAL_FIELDS))
	$(SCALAR_TRANSPORT_FOAM) -case $(1) > $(2).scalarTransportFoam.log

  $(addprefix $(1)/,$(ADVECTION_INITIAL_FIELDS)): $(2).intermediate

  $(2).intermediate: \
    $(1)/$(POLY_MESH_DIR) \
    $(addprefix $(3)/,$(MESH_FILES)) \
    $(1)/$(INITIAL_CONDITIONS) \
    $(1)/$(TRANSPORT_PROPERTIES)
	$(SET_SCALAR_OVER_OROGRAPHY) -case $(1) > $(2).setScalarOverOrography.log

  $(1)/$(POLY_MESH_DIR): $(3)/$(POLY_MESH_DIR)
	$(LN) -s $(abspath $(3)/$(POLY_MESH_DIR)) $(1)/$(POLY_MESH_DIR)

endef

$(eval $(call ADVECTION_TEMPLATE,openfoam/cases/advection/noOrography,advection-noOrography,openfoam/cases/mesh/noOrography))

$(eval $(call ADVECTION_TEMPLATE,openfoam/cases/advection/btf/schaerCos/vanLeer,advection-btf-schaerCos-vanLeer,openfoam/cases/mesh/btf/schaerCos))
