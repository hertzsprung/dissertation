END_TIME := 10000
INITIAL_CONDITIONS := constant/initialConditions
TRANSPORT_PROPERTIES := constant/transportProperties

ADVECTION_FINAL_TRACER_FIELD := $(END_TIME)/T
ADVECTION_INITIAL_FIELDS := 0/U 0/T

# $(1) -- simulation case path
# $(2) -- subproject label (e.g. advection_noOrography)
# $(3) -- mesh case path (e.g. btf/schaerCos)
define ADVECTION_TEMPLATE

  .PHONY: $(2) clean-$(2)
  .INTERMEDIATE: $(2).intermediate

  $(2): $(1)/$(ADVECTION_FINAL_TRACER_FIELD)

  clean-$(2):
	$(PY_FOAM_CLEAR_CASE) --additional=0 $(1)

  $(1)/$(ADVECTION_FINAL_TRACER_FIELD): $(addprefix $(1)/,$(ADVECTION_INITIAL_FIELDS))
	$(SCALAR_TRANSPORT_FOAM) -case $(1)

  $(addprefix $(1)/,$(ADVECTION_INITIAL_FIELDS)): $(2).intermediate

  $(2).intermediate: \
    $(addprefix $(3)/,$(mesh_FILES)) \
    $(1)/$(INITIAL_CONDITIONS) \
    $(1)/$(TRANSPORT_PROPERTIES)
	$(SET_SCALAR_OVER_OROGRAPHY) -case $(1)

endef

$(eval $(call ADVECTION_TEMPLATE,openfoam/cases/advection/noOrography,advection-noOrography,openfoam/cases/mesh/noOrography))

